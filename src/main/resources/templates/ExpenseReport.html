<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Expense Report</title>
		<link rel="icon" th:href="@{/dist/images/Dextero_Icon.ico}" type="image/x-icon" />
        <link th:href="@{https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700}" rel="stylesheet" />
        <link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}"/>
        <link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}" />
        <link rel="stylesheet" th:href="@{/dist/css/dextero.css}">
        <link rel="stylesheet" th:href="@{/dist/css/all.css}">

        <script th:src="@{/plugins/jquery/jquery.min.js}"></script>
        <script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
        <script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
        <script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
        <script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
        <script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
        <script th:src="@{/dist/js/dextero.js}"></script>
        <script th:src="@{/dist/js/all.js}"></script>

		<link rel="stylesheet" href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
		<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.4/css/select.dataTables.min.css">
		<script src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>
		<!--Export table button CSS-->
		<script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
		<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
		<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
		<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.min.js"></script>
		
		<style>
			tfoot td {
				font-weight:bold;
			}
		</style>
</head>

	<body class="hold-transition sidebar-mini layout-fixed">
	    <header th:include="header::header1"></header> 
		<div class="content-wrapper">
	        <section class="content-header">
	            <div class="container-fluid">
	                <div class="row">
	                    <div class="col-lg-12">
	                        <div class="card card-box-new tech-x-card-2 mt-5">
	                            <div class="card-body">
	                                <a th:href="@{/CreateExpenseReport/approved/{id}(id=${reportid})}">
	                                <button class="btn btn-info   col-2 mt-4 mb-3">Submit for Approval</button></a>
	
	                                <a th:href="@{/CreateExpenseReport/amend/{id}(id=${id})}">
	                                <button class="btn btn-info col-2 mt-4 mb-3 ">Send To Employee</button></a>   
	                                
	                                <form th:action="@{/ApprovedMultiExpenseReport}" method="GET">   
										<input type="submit" value="Bulk Approve" class="btn btn-info col-2 mt-4 mb-3">
										
	                                    <div class="table-responsive">
											<table id="data-table"  border="1" class="table table-bordered ">
												<thead>
													<tr>
														<th><input type="checkbox"></th>
														<th>Expense Category</th>
														<th>From Location</th>
														<th>To Location</th>
														<th>Location</th>
														<th>From Date</th>
														<th>To Date</th>
														<th>Mode of Travel</th>
														<th>Vendor</th>
														<th>Receipt</th>
														<th>Submitted Amount</th>
														<th>Approved Amount</th>
														<th>Action</th>
														<th>Status</th>
														<th>Reason</th>
													</tr>
												</thead>
												<tfoot>
													<tr>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td></td>
														<td>Totals</td>
														<td id="total"></td>
														<td id="Atotal"></td>
														<td></td>
														<td></td>
														<td></td>
													</tr>
		   										</tfoot>
		   										<tbody>
													<tr th:each="expense:${ExpenseReportList}" th:if="${expense.company_id}==${CompanyID}">
														<td><input type="checkbox" name="expense_id" th:value="${expense.id}"></td>
														<td th:text="${expense.Category}"></td>
														<td th:text="${expense.FromLocation}"></td>
														<td th:text="${expense.ToLocation}"></td>
														<td th:text="${expense.Location}"></td>
														<td th:text="${expense.FromDate}"></td>
														<td th:text="${expense.ToDate}"></td>
														<td th:text="${expense.ModeOfTravel}"></td>
														<td th:text="${expense.Vendor}"></td>
														<td><a th:href="@{'/Image Folder/' + ${expense.Receipt}}">
															<img  th:src="@{'/Image Folder/' + ${expense.Receipt}}" width="50" height="40" style="border: 1px solid black;"></img></a>
														</td>
														<td>
															<span th:text="${expense.currency}" id="data1"></span>
															<span th:text="${expense.Amount}" id="Amount"></span>
														</td>
														<td>
															<span th:text="${expense.currency}" id="data2" th:if="${expense.ApprovedRejectFlag}==true AND ${expense.active}==true" ></span>
							 								<span th:text="${expense.approvedamount}"  id="ApprovedAmount" th:if="${expense.ApprovedRejectFlag}==true AND ${expense.active}==true" ></span></td>
														<td>
	                   										<a th:href="@{/ExpenseReport/approved/{id}(id=${expense.id})}"
	                      										th:if="${expense.ApprovedRejectFlag}==false AND ${expense.active}==false">
	                         										<span class="text-success">Approve</span></a> 
	                    									<a th:href="@{/ExpenseReport/reject/{id}(id=${expense.id})}"
	                       										th:if="${expense.ApprovedRejectFlag}==false AND ${expense.active}==false">
	                          										<span class="text-danger" >Reject</span></a>
	                  									</td>
	                  									<td>   
	                   										<span th:if="${expense.active && expense.approvedRejectFlag}" class="text-success">APPROVE</span>
	                   										<span th:if="${!expense.active && expense.approvedRejectFlag}" class="text-danger">REJECT</span>
	                									</td>
	                									<td><!-- <form th:action="@{/Reason}" method="post"> --><input type="hidden" name="id" th:value="${expense.id}">
	                										<input type="text" name="reason" th:value="${expense.reason}">
															<button type="submit" value="" th:formaction="@{/Reason}">Save</button><!-- </form> -->
	                									</td>	
													</tr>
	                                            </tbody>
	                                        </table>
	                                    </div>
	                                </form>
	                                <div class="row mt-4"> 
	                                	<a th:href="@{/AllExpenseReportList}">Back to List</a>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>            
	        </section>
		</div>
		    <script type="text/javascript">
		        $(document).ready(function () {
		            var table = $('#data-table').DataTable({
		            	stateSave: true,
						stateDuration: 120,
						dom: 	"<'row'<'col-sm-0'l><'col-sm-3 text-right'B><'col-sm-4'<'toolbar'>><'col-sm-3'f>>" +
								"<'row'<'col-sm-12'tr>>" +
								"<'row'<'col-sm-5'i><'col-sm-7'p>>",
						buttons: [{ extend: 'print', text:'<i class="fa fa-print"></i> Print', className: 'btn btn-primary btn-md' }, 
						{ extend: 'excel',text:'<i class="fa fa-file-excel"></i> Excel', className: 'btn btn-primary btn-md' }] ,
						
		                columnDefs: [{
		                    targets: 0,
		                    orderable: false,
		                    searchable: false,
		                    className: 'selectall-checkbox',
		                }],
		                select: {
		                    style: 'multi',
		                    selector: 'td:first-child',
		                },
		                order: [6, 'asc'],
		
		            });
		            
					$(function() {
	            	var TotalValue1 = ' ';
	       				$("#data1").each(function(index,value){
		         			currentRow = ($(this).text());
		         			TotalValue1 += currentRow
	       			});
       				
       				var TotalValue = 0;
       				$("tr #Amount").each(function(index,value){
	         			currentRow1 = parseFloat($(this).text());
	         			TotalValue += currentRow1
       				});
					document.getElementById('total').innerHTML = TotalValue1 + '   ' + TotalValue;
				 });
		            
		            $(function () {
		            	var TotalValue1 = ' ';
	       				$("#data2").each(function(index,value){
		         			currentRow = ($(this).text());
		         			TotalValue1 += currentRow
	       				});
		                var TotalValue2 = 0;
		                $("tr #ApprovedAmount").each(function (index, value) {
		                    currentRow2 = parseFloat($(this).text());
		                    TotalValue2 += currentRow2
		                });
		                document.getElementById('Atotal').innerHTML = TotalValue1 + '   ' + TotalValue2;
		            });
		            
		            table.on('select.dt deselect.dt', function (e, dt, type, indexes) {
		                var countSelectedRows = table.rows({ selected: true }).count();
		                var countItems = table.rows().count();
		
		                if (countItems > 0) {
		                    if (countSelectedRows == countItems) {
		                        $('thead .selectall-checkbox input[type="checkbox"]', this).prop('checked', true);
		                    } else {
		                        $('thead .selectall-checkbox input[type="checkbox"]', this).prop('checked', false);
		                    }
		                }
		                if (e.type === 'select') {
		                    $('.selectall-checkbox input[type="checkbox"]', table.rows({ selected: true }).nodes()).prop('checked', true);
		                } else {
		                    $('.selectall-checkbox input[type="checkbox"]', table.rows({ selected: false }).nodes()).prop('checked', false);
		                }
		            });
		            // When clicking on "thead .selectall-checkbox", trigger click on checkbox in that cell.
		            table.on('click', 'thead .selectall-checkbox', function () {
		                $('input[type="checkbox"]', this).trigger('click');
		            });
		            // When clicking on the checkbox in "thead .selectall-checkbox"
		            table.on('click', 'thead .selectall-checkbox input[type="checkbox"]', function (e) {
		                if (this.checked) {
		                    table.rows().select();
		                } else {
		                    table.rows().deselect();
		                }
		                e.stopPropagation();
		            });
		
		        });
		        $("input").on("keypress", function(e) {
					if (e.which === 32 && !this.value.length)
						e.preventDefault();
				});
	    </script>
	</body> 
</html>