<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Create Expense Report</title>
		<link rel="icon" th:href="@{/dist/images/Dextero_Icon.ico}" type="image/x-icon" />
        <link th:href="@{https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700}" rel="stylesheet" />
        <link rel="stylesheet" th:href="@{/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}"/>
        <link rel="stylesheet" th:href="@{/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}" />
        <link rel="stylesheet" th:href="@{/dist/css/dextero.css}">
        <link rel="stylesheet" th:href="@{/dist/css/all.css}">

        <script th:src="@{/plugins/jquery/jquery.min.js}"></script>
        <script th:src="@{/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
        <script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
        <script th:src="@{/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
        <script th:src="@{/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
        <script th:src="@{/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
        <script th:src="@{/dist/js/dextero.js}"></script>
        <script th:src="@{/dist/js/all.js}"></script>
   		<link rel="stylesheet" href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
  		<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.4/css/select.dataTables.min.css">
		<script src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>
</head>

	<body class="hold-transition sidebar-mini layout-fixed">
    	<header th:include="header::header1"></header> 
  		<div class="content-wrapper">
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card-header text-center pb-2 d-bg-h2 ">
                                <lable id="label" class="h2 font-weight-bold">Create Expense Report</lable>
                            </div>
                            <div class="card card-box-new tech-x-card-2 mt-5">
                                <div class="card-body">
                                    <form action="#" th:action="@{/SaveExpenseReport}" th:object="${expense}" method="POST" autocomplete="off">
                                        <div class="row mt-4">
                                            <div class="col-sm-4 col-md-4 col-lg-4 required-field">
                                                <label class="d-label" >Expense Name:</label>
                                            </div>
                                            <div class="col-sm-6 col-md-4 col-lg-3">
                                                <input type="text" th:field="*{expenseName}" placeholder="Expense Name"  class="form-control input-anime" required>
                                            </div>
                                        </div>   
    
                                        <div class="row mt-4">
                                            <div class="col-sm-4 col-md-4 col-lg-4 required-field">
                                                <label class="d-label" >Date:</label>
                                            </div>
                                            <div class="col-sm-6 col-md-4 col-lg-2">
                                                <input class="form-control input-anime"  type="text" th:field="*{edate}" id="date" placeholder="DD-MM-YYYY" required>
                                            </div> 
                                            
                                            <input type="hidden" th:field="*{employee_id}" >
                                            	
                                            <div class="col-sm-6 col-md-4 col-lg-2">
                                            	<button type="submit" class="btn btn-info ">Create</button>
                                        	</div>  
                                       </div>
                                 	</form>
                                 	<div class="table-responsive mt-4">  
                                 	<table id="data-table" border="1" class="table table-bordered mt-4">
                                            <thead>
                                                <tr>
                                                    <th><input type="checkbox"></th>
                                                    <th>Expense Report ID</th>
                                                    <!-- <th>Employee Name</th> -->
                                                    <th>Expense Report Name</th>
                                                    <th>Date</th>
                                                    <!-- <th>Status</th> -->
                                                    <th>Edit</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="expense:${CreateExpenseReportList}" th:if="${expense.company_id}==${CompanyID} AND ${expense.employee_id}==${UserName}">
													<td><input type="checkbox" name="expense_id" th:value="${expense.id}"></td>
													<td th:text="${expense.id}"></td>
													<!-- <td class="text-center" th:each="e:${EmployeeList}" th:if="${e.email}==${expense.username}" th:text="${e.firstname} + ' ' + ${e.lastname}"></td> -->
													<td th:text="${expense.expenseName}"><!-- <a th:href="@{'/ExpenseReportList/' + ${expense.id}}" th:text="${expense.expenseName}"></a> --></td>
													<td th:text="${expense.edate}"></td>
                                                    <!-- <td>
                                                        <span th:if="${expense.active && expense.approvedRejectFlag}"
                                                            class="text-success">Approval Submitted By Manager</span>
                                                        <span th:if="${!expense.active && expense.approvedRejectFlag}"
                                                            class="text-danger">Reject By Manager</span>
                                                        <span th:if="${!expense.active && !expense.approvedRejectFlag}"
                                                            class="text-info">Approval Inprogress</span>
                                                        <span th:if="${expense.active && !expense.approvedRejectFlag}"
                                                            class="text-danger">Modification Required</span>
                                                    </td> -->
                                                    <td><a th:href="@{/EditCreateExpenseReport/{id}(id=${expense.id})}"><i class="fa-solid fa-pencil text-success"></i></a></td>
                                                </tr>
                                            </tbody>
                                        </table>   
                                  	</div>
                            	</div>
                        	</div>
                    	</div>
                	</div> 
             	</div>            
          </section>
      </div>  
		<script type="text/javascript">
			$(document).ready(function () {
				 var table = $('#data-table').DataTable({
				 columnDefs:[{
						targets:0,
						orderable:false,
						searchable:false,
						className:'selectall-checkbox',
					  }],
					select:{
						style:'multi',
						selector:'td:first-child',
					     },
					  order:[3,'desc'],
				    
				    "autoWidth": true,
							"footerCallback": function ( row, data, start, end, display ) {
								var api = this.api();
								nb_cols = api.columns().nodes().length;
								var colnumber = 2;
								while(colnumber < nb_cols){
									var pageTotal = api
				                .column(colnumber, { page: 'current'} )
				                .data()
				                .reduce( function (a, b) {
				                    return Number(a) + Number(b);
				                }, 0 );
				          // Update footer
				          $( api.column( colnumber).footer() ).html(pageTotal);
									colnumber++;
								} 
							}
						});
					table.on('select.dt deselect.dt' , function(e, dt, type, indexes){
					var countSelectedRows = table.rows({ selected: true}).count();
					var countItems = table.rows().count();
				
					if(countItems > 0){
					if(countSelectedRows == countItems){
						$('thead .selectall-checkbox input[type="checkbox"]', this).prop('checked', true);
					}else{
						$('thead .selectall-checkbox input[type="checkbox"]', this).prop('checked', false);
					}
					}
					if(e.type === 'select'){
						$('.selectall-checkbox input[type="checkbox"]', table.rows({ selected: true}).nodes()).prop('checked', true);
					}else{
						$('.selectall-checkbox input[type="checkbox"]', table.rows({ selected: false}).nodes()).prop('checked', false);	
					}
				});
				// When clicking on "thead .selectall-checkbox", trigger click on checkbox in that cell.
				table.on('click', 'thead .selectall-checkbox' , function(){
					$('input[type="checkbox"]', this).trigger('click');
				});
				// When clicking on the checkbox in "thead .selectall-checkbox"
				table.on('click', 'thead .selectall-checkbox input[type="checkbox"]', function(e){
					if(this.checked){
						table.rows().select();
					} else {
						table.rows().deselect();
					}
					e.stopPropagation();
				});
			  });
				var dateToday = new Date(); 
					$(document).ready(function () {
			            $( "#date" ).datepicker({
			    			dateFormat:'dd-mm-yy'
			  				});
			            var table = $('#data-table').DataTable();
					});
				$("input").on("keypress", function(e) {
					if (e.which === 32 && !this.value.length)
						e.preventDefault();
				});
				
		</script>
	</body>
</html>